version: '3.3'

services:
  webapi:
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - "5000:5000"
    depends_on:
      - mysql
    environment:
      MYSQL_HOST: mysql
      MYSQL_USER: arnau
      MYSQL_PASSWORD: isgrupA
      MYSQL_DB: integracioSistemes
    command: sh -c "service mysql stop && usermod -d /var/lib/mysql/ mysql && service mysql start && cd /home/basedades/is-grupA/db/src && python3 app.py"
    restart: on-failure

  mysql:
    image: mysql:5.7
    environment:
      MYSQL_ALLOW_EMPTY_PASSWORD: 1
      MYSQL_DATABASE: integracioSistemes
      MYSQL_USER: arnau
      MYSQL_PASSWORD: isgrupA
    volumes:
      - type: volume
        source: mysql-data
        target: /home/arnau/database

  webboard:
    image: isgrupa
    command: sh -c "cd /home/web/is-grupA/web-board && node -v && npm -v && npm install && npm start"
    ports:
      - "3000:3000"
    depends_on:
      - webapi

volumes:
  mysql-data:
